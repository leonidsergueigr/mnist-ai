<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Reconnaissance de Chiffres Manuscrits</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    animation: {
                        "pulse-slow": "pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite",
                        "bounce-gentle": "bounce 2s infinite",
                        gradient: "gradient 6s ease infinite",
                    },
                    keyframes: {
                        gradient: {
                            "0%, 100%": {
                                "background-size": "200% 200%",
                                "background-position": "left center",
                            },
                            "50%": {
                                "background-size": "200% 200%",
                                "background-position": "right center",
                            },
                        },
                    },
                },
            },
        };
    </script>
</head>

<body class="min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900">
    <!-- Particules d'arri√®re-plan -->
    <div class="fixed inset-0 overflow-hidden pointer-events-none">
        <div class="absolute top-10 left-10 w-2 h-2 bg-white rounded-full opacity-20 animate-pulse-slow"></div>
        <div class="absolute top-20 right-20 w-3 h-3 bg-purple-300 rounded-full opacity-30 animate-bounce-gentle"></div>
        <div class="absolute bottom-20 left-20 w-1 h-1 bg-blue-300 rounded-full opacity-40 animate-pulse"></div>
        <div class="absolute bottom-10 right-10 w-2 h-2 bg-indigo-300 rounded-full opacity-25 animate-bounce"></div>
    </div>

    <div class="container mx-auto px-4 py-6 md:py-12 relative z-10">
        <!-- Header avec informations du mod√®le -->
        <div class="max-w-6xl mx-auto">
            <!-- Titre principal -->
            <div class="text-center mb-8 md:mb-12">
                <h1
                    class="text-4xl md:text-6xl font-bold text-white mb-4 bg-gradient-to-r from-purple-400 via-pink-400 to-blue-400 bg-clip-text text-transparent animate-gradient">
                    üé® Reconnaissance de Chiffres
                </h1>
                <p class="text-lg md:text-xl text-purple-200 opacity-90">
                    Intelligence Artificielle ‚Ä¢ R√©seau de Neurones ‚Ä¢ MNIST Dataset
                </p>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 md:gap-8 mb-8">
                <!-- Section principale - Canvas -->
                <div class="lg:col-span-2">
                    <div class="bg-white/10 backdrop-blur-xl rounded-3xl p-6 md:p-8 border border-white/20 shadow-2xl">
                        <div class="text-center mb-6">
                            <h2 class="text-xl md:text-2xl font-semibold text-white mb-2">
                                Zone de Dessin
                            </h2>
                            <p class="text-purple-200 text-sm md:text-base">
                                Dessinez un chiffre de 0 √† 9 dans le cadre ci-dessous
                            </p>
                        </div>

                        <div class="flex justify-center mb-6">
                            <div class="relative">
                                <canvas id="canvas" width="400" height="400"
                                    class="border-4 border-white/30 rounded-2xl bg-black cursor-crosshair shadow-xl hover:border-white/60 transition-all duration-300 max-w-full h-auto"></canvas>
                                <div
                                    class="absolute -top-2 -right-2 w-4 h-4 bg-gradient-to-r from-pink-500 to-purple-500 rounded-full animate-pulse">
                                </div>
                            </div>
                        </div>

                        <div class="flex flex-col sm:flex-row gap-3 justify-center">
                            <button onclick="clearCanvas()"
                                class="px-6 py-3 bg-gradient-to-r from-red-500 to-pink-500 hover:from-red-600 hover:to-pink-600 text-white font-semibold rounded-2xl transition-all duration-300 transform hover:scale-105 hover:shadow-lg flex items-center justify-center gap-2">
                                <span class="text-lg">üóëÔ∏è</span>
                                Effacer
                            </button>
                            <button onclick="predict()" id="predictBtn"
                                class="px-8 py-3 bg-gradient-to-r from-emerald-500 to-blue-500 hover:from-emerald-600 hover:to-blue-600 text-white font-semibold rounded-2xl transition-all duration-300 transform hover:scale-105 hover:shadow-lg flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none">
                                <span class="text-lg">üîç</span>
                                Pr√©dire
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Informations du mod√®le -->
                <div class="space-y-6">
                    <!-- Informations techniques -->
                    <div class="bg-white/10 backdrop-blur-xl rounded-3xl p-6 border border-white/20 shadow-2xl">
                        <h3 class="text-lg font-semibold text-white mb-4 flex items-center gap-2">
                            <span class="text-xl">üß†</span>
                            Mod√®le IA
                        </h3>
                        <div class="space-y-3 text-sm">
                            <div class="flex justify-between items-center">
                                <span class="text-purple-200">Architecture:</span>
                                <span class="text-white font-medium">Dense Profond</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-purple-200">Couches:</span>
                                <span class="text-white font-medium">512‚Üí256‚Üí128‚Üí64‚Üí10</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-purple-200">Param√®tres:</span>
                                <span class="text-white font-medium">~500K</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-purple-200">Dataset:</span>
                                <span class="text-white font-medium">MNIST (70K images)</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-purple-200">Pr√©cision:</span>
                                <span class="text-emerald-400 font-bold">~98.5%</span>
                            </div>
                        </div>
                    </div>

                    <!-- Techniques utilis√©es -->
                    <div class="bg-white/10 backdrop-blur-xl rounded-3xl p-6 border border-white/20 shadow-2xl">
                        <h3 class="text-lg font-semibold text-white mb-4 flex items-center gap-2">
                            <span class="text-xl">‚ö°</span>
                            Optimisations
                        </h3>
                        <div class="space-y-2 text-sm">
                            <div class="flex items-center gap-2">
                                <div class="w-2 h-2 bg-emerald-400 rounded-full"></div>
                                <span class="text-purple-200">Batch Normalization</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <div class="w-2 h-2 bg-blue-400 rounded-full"></div>
                                <span class="text-purple-200">Dropout (30-40%)</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <div class="w-2 h-2 bg-purple-400 rounded-full"></div>
                                <span class="text-purple-200">Early Stopping</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <div class="w-2 h-2 bg-pink-400 rounded-full"></div>
                                <span class="text-purple-200">Learning Rate Decay</span>
                            </div>
                        </div>
                    </div>

                    <!-- Avertissement -->
                    <div class="bg-amber-500/20 backdrop-blur-xl rounded-3xl p-6 border border-amber-400/30 shadow-2xl">
                        <h3 class="text-lg font-semibold text-amber-300 mb-3 flex items-center gap-2">
                            <span class="text-xl">‚ö†Ô∏è</span>
                            Important
                        </h3>
                        <p class="text-amber-100 text-sm leading-relaxed">
                            Ce mod√®le d'IA peut commettre des erreurs. Les pr√©dictions sont
                            bas√©es sur des probabilit√©s et ne sont pas infaillibles.
                            Utilisez les r√©sultats avec discernement.
                        </p>
                    </div>
                </div>
            </div>

            <!-- Zone de r√©sultat int√©gr√©e -->
            <div class="bg-black/20 backdrop-blur-sm rounded-2xl p-4 border border-white/10">
                <div id="result"
                    class="text-center text-lg font-semibold text-purple-200 min-h-12 flex items-center justify-center">
                    Dessinez un chiffre et cliquez sur "Pr√©dire" ! ‚ú®
                </div>
            </div>

            <!-- Footer -->
            <div class="text-center mt-8 md:mt-12">
                <p class="text-purple-300 text-sm opacity-75">
                    Powered by TensorFlow ‚Ä¢ Optimis√© avec BatchNorm & Dropout ‚Ä¢ MNIST
                    Dataset
                </p>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById("canvas");
        const ctx = canvas.getContext("2d");
        const resultDiv = document.getElementById("result");
        const predictBtn = document.getElementById("predictBtn");

        ctx.fillStyle = "black";
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        let drawing = false;

        function resizeCanvas() {
            const containerWidth = canvas.parentElement.clientWidth;
            const maxSize = Math.min(containerWidth - 40, 400);
            canvas.style.width = maxSize + "px";
            canvas.style.height = maxSize + "px";
        }

        window.addEventListener("resize", resizeCanvas);
        resizeCanvas();

        let lastX = null;
        let lastY = null;

        canvas.addEventListener("mousedown", startDrawing);
        canvas.addEventListener("mouseup", stopDrawing);
        canvas.addEventListener("mousemove", draw);
        canvas.addEventListener("mouseleave", stopDrawing);

        canvas.addEventListener("touchstart", handleTouch);
        canvas.addEventListener("touchmove", handleTouch);
        canvas.addEventListener("touchend", stopDrawing);

        function startDrawing(e) {
            drawing = true;
            const rect = canvas.getBoundingClientRect();
            const scaleX = canvas.width / rect.width;
            const scaleY = canvas.height / rect.height;
            lastX = e.offsetX * scaleX;
            lastY = e.offsetY * scaleY;
            drawAtPosition(lastX, lastY);
        }

        function stopDrawing() {
            drawing = false;
            lastX = null;
            lastY = null;
        }

        function handleTouch(e) {
            e.preventDefault();
            const touch = e.touches[0];
            const rect = canvas.getBoundingClientRect();
            const scaleX = canvas.width / rect.width;
            const scaleY = canvas.height / rect.height;
            const x = (touch.clientX - rect.left) * scaleX;
            const y = (touch.clientY - rect.top) * scaleY;

            if (e.type === "touchstart") {
                drawing = true;
                lastX = x;
                lastY = y;
                drawAtPosition(x, y);
            } else if (drawing && e.type === "touchmove") {
                drawLine(lastX, lastY, x, y);
                lastX = x;
                lastY = y;
            }
        }

        function draw(e) {
            if (!drawing) return;
            const rect = canvas.getBoundingClientRect();
            const scaleX = canvas.width / rect.width;
            const scaleY = canvas.height / rect.height;
            const x = e.offsetX * scaleX;
            const y = e.offsetY * scaleY;

            if (lastX !== null && lastY !== null) {
                drawLine(lastX, lastY, x, y);
            }
            lastX = x;
            lastY = y;
        }

        function drawLine(x1, y1, x2, y2) {
            ctx.strokeStyle = "white";
            ctx.lineWidth = 20;
            ctx.lineCap = "round";
            ctx.lineJoin = "round";
            ctx.beginPath();
            ctx.moveTo(x1, y1);
            ctx.lineTo(x2, y2);
            ctx.stroke();
        }

        function drawAtPosition(x, y) {
            ctx.fillStyle = "white";
            ctx.beginPath();
            ctx.arc(x, y, 10, 0, 2 * Math.PI);
            ctx.fill();
        }

        function clearCanvas() {
            ctx.fillStyle = "black";
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            resultDiv.innerHTML =
                'Dessinez un chiffre et cliquez sur "Pr√©dire" ! ‚ú®';
            resultDiv.className =
                "text-center text-lg font-semibold text-purple-200 min-h-12 flex items-center justify-center";
        }

        async function predict() {
            predictBtn.disabled = true;
            resultDiv.innerHTML = `
                <div class="flex items-center justify-center gap-3">
                    <div class="w-6 h-6 border-2 border-yellow-400 border-t-transparent rounded-full animate-spin"></div>
                    <span class="text-yellow-400">Analyse en cours...</span>
                </div>
            `;
            resultDiv.className =
                "text-center text-lg font-semibold min-h-12 flex items-center justify-center";

            try {
                const dataURL = canvas.toDataURL();

                const response = await fetch("/predict", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ image: dataURL }),
                });

                const data = await response.json();

                if (data.status === "success") {
                    const confidence = (data.confidence * 100).toFixed(1);
                    resultDiv.innerHTML = `
                        <div class="text-center">
                            <div class="text-2xl md:text-4xl font-bold text-emerald-400 mb-2">
                                üéØ R√©sultat : <span class="text-white">${data.digit}</span>
                            </div>
                            <div class="text-emerald-300 mb-4">
                                üìä Confiance : ${confidence}%
                            </div>
                            <div class="w-full max-w-xs mx-auto bg-white/20 rounded-full h-3 overflow-hidden">
                                <div class="h-full bg-gradient-to-r from-emerald-500 to-blue-500 rounded-full transition-all duration-1000 ease-out" 
                                     style="width: ${confidence}%"></div>
                            </div>
                        </div>
                    `;
                    resultDiv.className =
                        "text-center min-h-12 flex items-center justify-center";
                } else {
                    throw new Error(data.error || "Erreur inconnue");
                }
            } catch (error) {
                console.error("Erreur:", error);
                resultDiv.innerHTML = `
                    <div class="text-center">
                        <div class="text-red-400 text-xl font-semibold">‚ùå Erreur</div>
                        <div class="text-red-300 text-sm mt-1">${error.message}</div>
                    </div>
                `;
                resultDiv.className =
                    "text-center min-h-16 flex items-center justify-center";
            } finally {
                predictBtn.disabled = false;
            }
        }

        window.addEventListener("load", async () => {
            try {
                const response = await fetch("/health");
                const health = await response.json();
                console.log("√âtat de l'API:", health);
            } catch (error) {
                console.warn("Impossible de v√©rifier l'√©tat de l'API:", error);
                const footer = document.querySelector("footer") || document.body;
                const notice = document.createElement("div");
                notice.className =
                    "fixed bottom-4 right-4 bg-amber-500/20 text-amber-300 px-4 py-2 rounded-lg text-sm backdrop-blur-sm border border-amber-400/30";
                notice.textContent = "Mode d√©mo - API non connect√©e";
                document.body.appendChild(notice);
                setTimeout(() => notice.remove(), 5000);
            }
        });
    </script>
</body>

</html>